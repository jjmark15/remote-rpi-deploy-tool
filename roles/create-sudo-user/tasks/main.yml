---

- name: create a sudo user
  user:
    name: "{{ ansible_ssh_user }}"
    state: present
    groups: "{{ ansible_ssh_user }} adm dialout cdrom sudo audio video plugdev games users input netdev spi i2c gpio wheel"
    password: "{{ ansible_ssh_pass }}"

- lineinfile:
    line: "%wheel         ALL = (ALL) NOPASSWD: ALL"
    path: /etc/sudoers

- name: allow wheel group to have passwordless sudo
  lineinfile:
    path: /etc/sudoers
    state: present
    regexp: '^%wheel'
    line: '%wheel ALL=(ALL) NOPASSWD=ALL'
    validate: 'visudo -cf %s'